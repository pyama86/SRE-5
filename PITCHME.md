---

### SRE輪読会 #5
#### 4章サービスレベル目標
#### 5章トイルの撲滅
#### 29章割り込みへの対処
### (@pyama86)

<span style="color:gray">花粉終わったと思ったら完全にぶり返してニンジャリバンバン</span>

---
### 4章の用語
#### SLI サービスレベル指標
例えばAPIのレイテンシとかエラーレベルとか、可用性
#### SLO サービスレベル目標
定めたSLIのどのレベルを目標にするのか
#### SLA サービスレベルアグリーメント(合意水準)
顧客に約束するサービスレベルであることが多い

---
### SLI深掘り
#### メトリクス全てをSLIにすべきではない
多すぎると適切な運用が出来ない、また正しい指標を選んでいれば、少ない指標で十分に評価し、判断できる
#### 指標の収集
GoogleではBorgmonやPrometheusを利用。通常はサーバサイドで集めるが、Javascriptなどクライアントサイドで稼働するものは、クライアントで収集する

---
### SLI深掘り
#### 集計
平均よりも分布が良い(ペパボは95パーセンタイル)

#### 指標標準化
指標の例えば収集間隔や頻度はテンプレート化して使いまわす

---
### SLO深掘り
#### 目標の複数指定
- 90%が1ミリ秒以下で完了
- 99%が10ミリ秒以下で完了
- 99.9%が100ミリ秒以下で完了

多様なユーザーが居るのであれば、それぞれのワークロードに応じて目標を設定すると良い。また常に目標を満たし続けることを求めるのは悪手であり、イノベーションや、リリースの妨げとなる。もしSLOを満たせないのであれば、エラーバジェットでで管理すべきだろう。

---
### SLO深掘り
#### ターゲットの選択
- 現在のパフォーマンスに基づいてターゲットを選択しない
例えば、現状のレイテンシが0.0001secとかだっとしても、それは実績であって目標として適切かどうかは考えるべき

- 最小限に留める
満たすべき要件の必要最小限を選択する。過剰な品質を求めない

---
### SLO深掘り
#### ターゲットの選択
- 最初から完璧でなくても良い

あとから緩めるよりは、まずは緩めに初めて、あとから厳しくしていく方が良い。また厳しすぎるSLOは達成することが目的となってしまい、プロダクトに対して必ずしも寄与しないので、適切に設定し懸命に利用する。

---

### SLO深掘り
#### 実際どう運用する
- 計測
- 判断
- 計画
- 実行

---
### 5章の用語
#### トイル
- プロダクションの動作に必要
- 手作業で繰り返し実行
- 自動化出来る
- 長期的に価値がない
- サービスの成長に比例して増える
 - 例えば顧客からの同じ内容の問い合わせ
 - 一定確率で発生する同じ内容のアプリケーションエラー対応

---

### トイル深掘り
#### Googleではトイルは50%以下
SREチームの作業時間の50%以上は、エンジニアリングに費やす。SREにおけるエンジニアリングとは、トイルを減らし、サービスをスケールさせる作業である。

---
### トイル深掘り
#### エンジニアリングである条件
エンジニアリングの作業とは、新しいことをするものであり、本質的に人間の判断を必要とする。なるべくエンジニアリングするぞ！！！１

---

### トイル深掘り
#### トイルは常に悪ではない

多少のトイルは避けられない、それをみんなが認識しておく必要がある。一方で大きいトイルは下記を招く

- キャリアの停滞
運用作業は目立たないし、地味だし、バーン感がない。
- モラルの低下
そこにやりがいがないと、燃え尽きたり、単純につまらない。
- 生産性の低下
本来必要なエンジニアリングの時間が失われてしまう。


---

### 29章の用語
#### ページ
一般的にはサービスやアプリケーションからのアラート？
#### チケット
顧客からの問い合わせとか？

#### 運用業務の負荷
トイル！！！１

---
### 割り込み深掘り
#### そもそもなぜ割り込みがだめなのか
- フロー状態の阻害
- コンテキストスイッチの発生

---
### 割り込み深掘り
#### 解決策
- Googleではオンコールエンジニアが決まっている(プライマリ/セカンダリ)
オンコールエンジニアは、ページ・チケットの処理だけを行う。
- チケットの割り振りをランダムにやるとかだめ
チケットが急にふられると、それは割り込みである。これらも基本的にはオンコールエンジニアが受けるべき。

---
### 割り込み深掘り
#### 自分しかわからないノウハウ問題
何か問題が起きた時に、◯◯さんしか、わからないとかありがち。これはなるべくなくしていくのがいいし、積極的にその人意外が対応すべき。

---
### 割り込み深掘り
#### チケットの引き継ぎ
オンコール作業だけではなく、チケットの引き継ぎが必要。オンコールの日に受けたチケットを、引き継ぐことで、エンジニアリングに集中する。

---
### 割り込み深掘り
#### 全てを対応する必要はない、顧客とともに自分も尊重する

サービスレベル以上のページや、チケットは必ずしも対応する必要はない。ときには顧客に返す選択もすべきである。
